---
import type { ImageMetadata } from 'astro';
import {getCollection} from "astro:content"
import {Image} from 'astro:assets';

import BaseLayout from "../../layouts/BaseLayout.astro"

const {slug} = Astro.params

const products = await getCollection('products')
const product = products.find(product => product.data.name === slug)

if (!product) return Astro.redirect("/404")

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/**/*.{jpeg,jpg,png,gif}')
if (!images[product.data.image]) throw new Error(`"${product.data.image}" does not exist in glob: "src/assets/**/*.{jpeg,jpg,png,gif}"`);
---

<BaseLayout>
  <h2>{product.data.name}</h2>
  <p>{product.data.description}</p>
  <Image src={images[product.data.image]()} alt={product.data.name}/>
</BaseLayout>