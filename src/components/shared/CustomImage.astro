---
import { Image } from "astro:assets";

const { src, alt } = Astro.props
---

<script>
  import { html, LitElement, type PropertyValues } from 'lit';
  import { property } from 'lit/decorators.js';

  class CustomImage extends LitElement {
    @property({type: Boolean}) ready = false

    constructor() {
      super()
    }

    connectedCallback(): void {
        super.connectedCallback()

        const image = this.querySelector('img')

        if (image?.complete) {
          this.ready = true
        }
        
        image?.addEventListener('load', () => {
          this.ready = true
        })
    }

    updated(changedProperties: PropertyValues<this>) {
      const image = this.querySelector('img')
      if (image && this.ready) {
        image.classList.add('ready')
      }
    }

    render() {
      return html`<slot></slot>`
    }
  }

  customElements.define('custom-image', CustomImage)

</script>

<custom-image>
  <sl-skeleton effect="pulse"></sl-skeleton>
  <Image src={src()} alt={alt} loading="eager"/>
</custom-image>

<style>


  img {
    width: 0;
    object-fit: contain;
  }
</style>